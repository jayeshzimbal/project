name: Deploy Python Flask App

on:
  push:
    branches:
      - main   # Deploy when code is pushed to main branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    # 1️⃣ Checkout code from repo
    - name: Checkout Repository
      uses: actions/checkout@v3

    # 2️⃣ Deploy to EC2 using SSH
    - name: Deploy to EC2
      uses: appleboy/ssh-action@v1.0.0
      with:
        host: ${{ secrets.JAY }}          # Your EC2 public IP
        username: ${{ secrets.EC2_USER }} # SSH username, e.g., ec2-user
        key: ${{ secrets.EC2_KEY }}       # Your private key (.pem) content
        port: 22
        script: |
          # Navigate to project folder
          cd ~/project/project/git-action
          
          # Activate virtual environment
          source ../../venv/bin/activate
          
          # Install Flask (if not installed)
          pip install --upgrade pip
          pip install flask
          
          # Run the app in background
          nohup python app.py &
          
          # Optional: print running processes
          ps aux | grep python
